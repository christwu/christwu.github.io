<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"plusnan.me",root:"/",scheme:"Muse",version:"7.8.0",exturl:!0,sidebar:{position:"right",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="出于跨公司联调需要，我们需准备能让对方公司访问到的URL。如果公司并不具备这个条件（或者拒绝开通环境），我们如何自行准备环境呢？"><meta property="og:type" content="article"><meta property="og:title" content="内网穿透教程"><meta property="og:url" content="https://plusnan.me/2018/07/14/tunnel/index.html"><meta property="og:site_name" content="infNaN"><meta property="og:description" content="出于跨公司联调需要，我们需准备能让对方公司访问到的URL。如果公司并不具备这个条件（或者拒绝开通环境），我们如何自行准备环境呢？"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://plusnan.me/img/2018-07-14-cross-company-debug/putty-tunnel.png"><meta property="article:published_time" content="2018-07-13T16:00:00.000Z"><meta property="article:modified_time" content="2020-04-21T13:24:50.111Z"><meta property="article:author" content="infNaN"><meta property="article:tag" content="内网穿透"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://plusnan.me/img/2018-07-14-cross-company-debug/putty-tunnel.png"><link rel="canonical" href="https://plusnan.me/2018/07/14/tunnel/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>内网穿透教程 | infNaN</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-134391990-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-134391990-1")}</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/rss.xml" title="infNaN" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">infNaN</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://plusnan.me/2018/07/14/tunnel/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/myavatar.jpg"><meta itemprop="name" content="infNaN"><meta itemprop="description" content="多穿女装少踩坑"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="infNaN"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">内网穿透教程</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-14 00:00:00" itemprop="dateCreated datePublished" datetime="2018-07-14T00:00:00+08:00">2018-07-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-04-21 21:24:50" itemprop="dateModified" datetime="2020-04-21T21:24:50+08:00">2020-04-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">教程</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>出于跨公司联调需要，我们需准备能让对方公司访问到的URL。如果公司并不具备这个条件（或者拒绝开通环境），我们如何自行准备环境呢？</p><a id="more"></a><p>操作之前需要去搞一台VPS服务器。VPS有国内、国外的，优缺点分别如下：</p><table><thead><tr><th>地区</th><th>优势</th><th>缺点</th><th>代表厂商</th></tr></thead><tbody><tr><td>国内（不含香港）</td><td>网速快<br>网络稳定</td><td>价格较贵，多数需月付<br>未经备案通常会禁止使用80、443、8080等端口，而备案耗时较长，会延误工作</td><td>阿里云、腾讯云等</td></tr><tr><td>香港</td><td>网速快<br>不需要备案，可直接使用80、443等端口</td><td>价格较贵<br>有被墙的风险</td><td>暂无推荐，可自行Google查询</td></tr><tr><td>国外</td><td>价格便宜，有些厂商甚至可按实际使用时间支付，随时买随时扔<br>不需要备案</td><td>网络不稳定，容易被墙<br>需要能付外币的信用卡</td><td>Vultr、DigitalOcean、Linode</td></tr></tbody></table><div class="note danger"><p>计划以内网穿透方法进行联调之前，请留意自己公司的管理制度里面有没有网络限制，以免倒霉被抓挨罚。如果能以遵守制度的方式将内网端口映射到公网，建议走公司的手续。</p></div><div class="note info"><p>使用Vultr部署时建议选择洛杉矶或东京节点，这两个网络相对而言比较好。购买时注意不要选$2.5的机器，因为没有IPv4地址。</p></div><div class="note warning"><p>有时候你的服务器会出现Ping不通，或者出现能Ping通但是SSH连接超时的情况，这很可能是你服务器的IP或端口被墙了。如果遇到这种情况，可以去买一台新机器并删除旧的机器。另外有时候需要多刷几次。</p></div><p>以Vultr为例。选择该厂商，有以下几个原因：</p><ul><li>随时用，随时扔，按实际使用时间付费</li><li>可以使用微信、支付宝付款</li></ul><p>不过该厂商服务器也有几个坑需要留意：</p><ul><li>数据中心选东京或洛杉矶</li><li>不要选择$2.5的机器，那个是纯IPv6访问，你可能连不上</li><li>由于中国人经常买这家服务器来翻墙，Vultr的服务器在国内访问效果并不太好，有时需要刷IP（买新机器然后删除旧机器）才能在国内连接上</li></ul><p>为了方便，新机器操作系统选择Ubuntu。启动完成之后，先在公司Ping一下，没问题的话就可以用PuTTY等软件建立连接了。输入Vultr网站上面给你提供的服务器IP（端口22）、用户名和密码，然后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>将其中的<code>GatewayPorts no</code>改成<code>yes</code>，没找到的话就在文件末尾追加一行，保存。然后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart sshd</span><br></pre></td></tr></table></figure><p>准备工作就做好了。</p><div class="note warning"><p>有些操作系统（例如CentOS）会默认开启防火墙，所以要确认一下防火墙状态，然后关闭防火墙或者开放待使用端口。</p></div><p>联调时先去下载PuTTY，启动，在里面输入服务器地址和端口（默认22），并且按下图进行设置</p><p><img src="/img/2018-07-14-cross-company-debug/putty-tunnel.png" alt="PuTTY设置"></p><p>不要忘记点Add按钮。假如本机是<code>http://172.18.106.3:8080</code>，服务器IP是198.13.60.108，你选择的端口是8080，那么登录成功后就可以通过<code>http://198.13.60.108:8080</code>来访问自己的应用了。</p><div class="note warning"><p>因为是外国服务器，所以连接可能不太稳定，需要不定期检查连接，断了的话随时重新连。</p></div><div class="note info"><p>如果需要域名，我个人建议去<span class="exturl" data-url="aHR0cHM6Ly9uYW1lY2hlYXAuY29t">Namecheap<i class="fa fa-external-link-alt"></i></span>上面购买个便宜的外国域名（注意：需要准备Visa/MasterCard信用卡）。如果还需要HTTPS，可以使用Let’s Encrypt。如果有国内已备案域名，也可以给应用建个二级域名，但是在国内购买新的一级域名需要花时间备案。</p></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>infNaN</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://plusnan.me/2018/07/14/tunnel/" title="内网穿透教程">https://plusnan.me/2018/07/14/tunnel/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag"># 内网穿透</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2018/05/15/deployment/" rel="prev" title="Web应用部署注意事项"><i class="fa fa-chevron-left"></i> Web应用部署注意事项</a></div><div class="post-nav-item"><a href="/2018/07/14/cross-company-debug/" rel="next" title="接口设计与联调经验">接口设计与联调经验 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="infNaN" src="/img/myavatar.jpg"><p class="site-author-name" itemprop="name">infNaN</p><div class="site-description" itemprop="description">多穿女装少踩坑</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luZm5hbg==" title="GitHub → https://github.com/infnan"><i class="github fa-fw"></i>GitHub</span> </span><span class="links-of-author-item"><a href="mailto:me@plusnan.me" title="E-Mail → mailto:me@plusnan.me"><i class="envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="/rss.xml" title="RSS → /rss.xml"><i class="rss fa-fw"></i>RSS</a></span></div><div class="cc-license motion-element" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">infNaN</span></div><div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9tdXNlLnRoZW1lLW5leHQub3Jn">NexT.Muse</span> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/disqusjs@1/dist/disqusjs.css"><script>NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/disqusjs@1/dist/disqus.js', () => {
    window.dsqjs = new DisqusJS({
      api       : 'https://api.plusnan.me/disqus/' || 'https://disqus.com/api/',
      apikey    : 'sFepWzyVneUjG9XYJBAD5vGwBDuY2xvmf09d6cXO0aNxDrCPi9ZfjpAQ1B2UZ6Sg',
      shortname : 'plusnan',
      url       : "https://plusnan.me/2018/07/14/tunnel/",
      identifier: "2018/07/14/tunnel/",
      title     : "内网穿透教程",
    });
  }, window.DisqusJS);
});</script></body></html>