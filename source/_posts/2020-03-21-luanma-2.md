---
layout: post
title: Webåº”ç”¨ä¸­æ–‡ä¹±ç å®éªŒï¼ˆäºŒï¼‰ï¼šHTTP Requestä¸­æ–‡ç¼–ç æµ‹è¯•
category: é—²è°ˆ
tags:
- ä¹±ç 
---
æœ¬æ–‡å€ŸåŠ©WiresharkæŠ“åŒ…è½¯ä»¶ï¼Œç ”ç©¶è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå«æœ‰ä¸­æ–‡çš„å„ç±»HTTPè¯·æ±‚ï¼Œä»æµè§ˆå™¨ã€å‘é€ã€‘å‡ºå»ä¹‹åã€è¢«Tomcatç­‰ä¸­é—´ä»¶æ¥æ”¶ä¹‹å‰ï¼Œå®ƒçš„å†…éƒ¨ç”¨äº†ä»€ä¹ˆç¼–ç å‘¢ï¼Ÿ

<!-- more -->

# çº¦å®š
ä¸ºä¾¿äºè®¨è®ºï¼Œæœ¬æ–‡ä½œå‡ºä»¥ä¸‹çº¦å®šï¼š

* GBKï¼šå¿½ç•¥GB2312ã€GBKã€GB18030ç­‰ä¸­å›½ç¼–ç çš„å†…éƒ¨å·®å¼‚ï¼Œç»Ÿä¸€ä½¿ç”¨GBKè¡¨ç¤ºã€‚å‡è®¾Windowsç³»ç»Ÿé»˜è®¤ä½¿ç”¨GBKç¼–ç ã€‚
* ç°ä»£æµè§ˆå™¨ï¼šæŒ‡é™¤äº†IEä»¥å¤–çš„ã€ç‰ˆæœ¬ä¸å¤ªè€çš„å…¶ä»–æµè§ˆå™¨ï¼Œä¾‹å¦‚Chromeã€Firefoxã€Safariï¼Œä»¥åŠç”¨äº†Chromiumç­‰å†…æ ¸çš„å›½äº§æµè§ˆå™¨ã€‚å›½äº§æµè§ˆå™¨é€šå¸¸æ˜¯åŒå†…æ ¸ï¼Œå…¶IEå†…æ ¸æ¨¡å¼åˆ™æ’é™¤åœ¨å¤–ã€‚
* IEï¼šé»˜è®¤åŒ…å«å›½äº§æµè§ˆå™¨çš„IEå†…æ ¸æ¨¡å¼ã€‚æœ‰ç‰¹æ®Šè¯´æ˜çš„é™¤å¤–ã€‚
* Linuxï¼šæœ¬æ–‡ä½¿ç”¨Macç³»ç»Ÿè¿›è¡Œæµ‹è¯•ï¼Œå¹¶å‡è®¾Macä¸Linuxä¸€æ ·ï¼Œè€Œä¸”å®é™…ä¸Šç»“è®ºå°±æ˜¯ä¸€æ ·çš„ã€‚

# å‡†å¤‡å·¥ä½œ
## ç®€æ˜“HTTP Server
ä¸ºäº†æ’é™¤Javaä¸Tomcatçš„å„ç§å¹²æ‰°ï¼Œæˆ‘ä»¬ç”¨å¦ä¸€ç§è¯­è¨€â€”â€”Node.jsæ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„HTTP Serverã€‚åœ¨Node.jsä¸­å­—ç¬¦ä¸²å†…éƒ¨ä»¥UTF-8ç¼–ç å­˜å‚¨ï¼ˆå¤‡æ³¨ï¼šè¿™å¥è¯ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šå’ŒJavaä¸€æ ·ä¹Ÿæ˜¯UTF-16ï¼‰ï¼Œè€Œä¸”æœ¬æ–‡æ‰€ç”¨çš„expressä¹Ÿä¼šé»˜è®¤è®©Content-Typeä½¿ç”¨UTF-8ï¼š

server.jsï¼š
```js
const Buffer = require('buffer').Buffer;
const express = require('express');
const bodyParser = require('body-parser');

const app = express();

// è®©expressä¸å¯¹ç”¨æˆ·ä¼ å…¥å‚æ•°ä½œä»»ä½•è§£æ
app.use(bodyParser.text({ type: '*/*' }));

const object2str = (obj) => {
    let output = [];

    if (typeof obj === 'object' && obj) {
        for (let key in obj) {
            if (obj[key]) {
                let value = obj[key].toString();
                let keyBuffer = Buffer.from(key);
                let valueBuffer = Buffer.from(value);

                output.push(`${key} = ${value}`);
                output.push(`\t${keyBuffer.toString('hex')} = ${valueBuffer.toString('hex')}`);
            }
        }
    } else if (typeof obj === 'string') {
        output.push(obj);
        output.push('\n');
        output.push(Buffer.from(obj).toString('hex')); 
    }

    return output.join('\n');
};

const handler = (req, res) => {
    res.header({
        'Content-Type': 'text/plain'
    });

    let output = [];

    // å°†ç”¨æˆ·ä¼ å…¥çš„å‚æ•°åŸæ ·è¾“å‡º
    output.push(`${req.method} ${req.originalUrl}`);
    output.push('');

    output.push('Query:');
    output.push(object2str(req.query));
    output.push('');

    output.push('Params:');
    output.push(object2str(req.params));
    output.push('');

    output.push('Body:');
    output.push(object2str(req.body));
    output.push('');

    res.send(output.join('\n'));
};

const createForm = (encoding) => `
<html>
    <head>
        <meta charset="${encoding}" />
        <title>TEST</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <h2>GET Form</h2>
        <form action="/get" method="GET">
            Name: <input type="text" name="name">
            <input type="submit">
        </form>

        <h2>POST Form</h2>
        <form action="/post" method="POST">
            Name: <input type="text" name="name">
            <input type="submit">
        </form>

        <h2>POST Form (multipart/form-data)</h2>
        <form action="/post" method="POST" enctype="multipart/form-data">
            Name: <input type="text" name="name">
            <input type="submit">
        </form>

        <h2>Ajax Form</h2>
        Name: <input type="text" id="text">
        <button type="button" onclick="ajaxTest('get')">Ajax GET</button>
        <button type="button" onclick="ajaxTest('post')">Ajax POST</button>
        <button type="button" onclick="ajaxTest2()">Ajax GET 2</button>

        <script>
            function ajaxTest(type) {
                $.ajax({
                    url: '/' + type,
                    type: type,
                    data: {
                        name: $('#text').val()
                    },
                    success: function (data) {
                        alert(data);
                    }
                });
            }

            function ajaxTest2() {
                var text = $('#text').val();
                $.ajax({
                    url: '/get/' + text + '?name=' + text,
                    type: 'get',
                    success: function (data) {
                        alert(data);
                    }
                });
            }
        </script>
    </body>
</html>
`;

app.get('/', handler);
app.get('/get', handler);
app.get('/get/:name', handler);
app.post('/post', handler);
app.post('/post/:name', handler);

app.get('/form/utf-8', (req, res) => {
    // æ¡†æ¶ä¼šè‡ªåŠ¨è¿½åŠ  charset=utf-8
    res.send(createForm('utf-8'));
});

app.get('/form/gbk', (req, res) => {
    res.header({
        'Content-Type': 'text/html; charset=gbk'
    });
    // å¿…é¡»sendä¸€ä¸ªBufferï¼Œä¸èƒ½sendä¸€ä¸ªstringï¼Œå¦åˆ™æ¡†æ¶ä¼šæŒ‰UTF-8å¤„ç†
    res.send(Buffer.from(createForm('gbk')));
});

app.listen(8000, () => {
    console.log(`Listening at http://0.0.0.0:8000... Press Ctrl+C to stop.`);
});
```

ä½¿ç”¨npmå®‰è£…expressä¸body-parserã€‚å‡†å¤‡å®Œæ¯•åï¼Œä½¿ç”¨`node server.js`è¿è¡ŒæœåŠ¡å™¨ã€‚

è¯¥HTTP ServeråŠŸèƒ½å¦‚ä¸‹ï¼š

* `/get`ï¼šæ˜¾ç¤ºGETè¯·æ±‚å‚æ•°
* `/post`ï¼šæ˜¾ç¤ºPOSTè¯·æ±‚å†…å®¹
* `/get/xxx`ï¼šé‡å¤getåé¢çš„å†…å®¹
* `/post/xxx`ï¼šé‡å¤poståé¢çš„å†…å®¹
* `/form/gbk`ï¼šæ˜¾ç¤ºä¸€ä¸ªä»¥GBKç¼–ç å±•ç¤ºçš„è¡¨å•ï¼Œç³»ç»Ÿå…¥å£
* `/form/utf-8`ï¼šæ˜¾ç¤ºä¸€ä¸ªä»¥UTF-8ç¼–ç å±•ç¤ºçš„è¡¨å•ï¼Œç³»ç»Ÿå…¥å£

## è¯†åˆ«å­—ç¬¦ç¼–ç 
`ä¸­æ–‡`

```
UTF-8ï¼š
e4 b8 ad e6 96 87
-------- --------
   ä¸­       æ–‡

GBKï¼š
d6 d0 ce c4
----- -----
  ä¸­    æ–‡
```

## Wireshark
Wiresharkæ˜¯ä¸€æ¬¾æ”¯æŒå¤šç§åè®®çš„æŠ“åŒ…è½¯ä»¶ã€‚ä½¿ç”¨è¯¥è½¯ä»¶æŠ“åŒ…æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®åŒ…çš„äºŒè¿›åˆ¶ä¿¡æ¯ï¼Œä»è€Œåˆ¤æ–­è¯·æ±‚ç”¨äº†å“ªç§ç¼–ç ã€‚

å®‰è£…å¹¶å¯åŠ¨Wiresharkï¼Œå¯çœ‹åˆ°é€‰æ‹©è®¾å¤‡çš„çª—å£ï¼š

![](/img/2020-03-21-luanma-2/wireshark-1.png)

åŒå‡»æŸä¸ªç½‘å¡ï¼Œç¨‹åºå°±ä¼šæ•è·ç»è¿‡æŸä¸ªç½‘å¡çš„å„ç±»ç½‘ç»œæµé‡ã€‚ç”±äºè®¿é—®çš„æ˜¯æœ¬æœºè¿è¡Œçš„HTTP Serverï¼Œæˆ‘ä»¬éœ€è¦åŒå‡»â€œLoopbackâ€ã€‚

è¿›å…¥æ•è·ç•Œé¢ï¼Œåœ¨è¿‡æ»¤æ¡ä»¶ä¸­è¾“å…¥`http`ï¼Œå³å¯è¿‡æ»¤å‡ºæœ¬æœºè®¿é—®æœ¬æœºçš„HTTPæµé‡ï¼š

![](/img/2020-03-21-luanma-2/wireshark-2.png)

æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨ä¸¤ä¸ªæ“ä½œç³»ç»Ÿï¼Œä¸€ä¸ªæ˜¯Macï¼ˆæœ¬æœºï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯Windowsï¼ˆè™šæ‹Ÿæœºï¼‰ï¼Œé€‰æ‹©Captureçš„ç½‘å¡æ—¶ï¼Œå‡é€‰æ‹©â€œLoopbackâ€ã€‚

# æµ‹è¯•
æˆ‘ä»¬æµ‹è¯•ä»¥ä¸‹å‡ ç§æƒ…å½¢ï¼š

* GETè¯·æ±‚ï¼š
    * åœ¨æµè§ˆå™¨åœ°å€æ ç›´æ¥è¾“å…¥URLã€æŸ¥è¯¢å‚æ•°
    * åœ¨UTF-8/GBKç¼–ç é¡µé¢é€šè¿‡&lt;form&gt;è¾“å…¥æŸ¥è¯¢å‚æ•°
* POSTè¯·æ±‚ï¼šåœ¨UTF-8/GBKç¼–ç é¡µé¢é€šè¿‡&lt;form&gt;è¾“å…¥å‚æ•°
* ä½¿ç”¨jQueryçš„$.ajaxå‘é€GET/POSTè¯·æ±‚

æµ‹è¯•ç¯å¢ƒï¼š

* æ“ä½œç³»ç»Ÿï¼šLinux/Macã€Windows
* æµè§ˆå™¨ï¼šIE8ã€IE11ã€æ–°ç‰ˆChromeï¼ˆç‰ˆæœ¬>70ï¼‰ã€æ—§ç‰ˆChromeï¼ˆç‰ˆæœ¬49ï¼‰ã€æ–°ç‰ˆFirefoxï¼ˆç‰ˆæœ¬>70ï¼‰ã€æ—§ç‰ˆFirefoxï¼ˆç‰ˆæœ¬<20ï¼‰ã€360æµè§ˆå™¨ï¼ˆç‰ˆæœ¬12ï¼ŒWindowsï¼‰
* å…¶ä»–è½¯ä»¶ï¼šcurlã€Postman

# ç»“è®º
æµ‹è¯•ç»“è®ºå¦‚ä¸‹ã€‚é™¤IEå¤–ï¼Œå…¶ä»–æµè§ˆå™¨ä¸å—æ“ä½œç³»ç»Ÿå½±å“ã€‚

## GETè¯·æ±‚ï¼Œåœ°å€æ ç›´æ¥è¾“å…¥ç½‘å€
```
 http :// 127.0.0.1:8000 / get / ä¸­æ–‡ ? name = ä¸­æ–‡
 -----------------------------------   -----------
                 URL                     è¯·æ±‚å‚æ•°

%E4%B8%AD%E6%96%87 -> URL Encodedï¼ˆæŒ‰UTF-8ç¼–ç ï¼‰
%D6%D0%CE%C4 -> URL Encodedï¼ˆæŒ‰GBKç¼–ç ï¼‰
```

| æµ‹è¯•ç¯å¢ƒ                  | URLç¼–ç               | è¯·æ±‚å‚æ•°ç¼–ç               |
|--------------------------|---------------------|-------------------------|
| ç°ä»£æµè§ˆå™¨                | UTF-8, URL encoded  | UTF-8, URL encoded       |
| IEï¼ˆæ’é™¤å›½äº§æµè§ˆå™¨ï¼‰       | UTF-8, URL encoded  | è·Ÿéšç³»ç»Ÿï¼ˆGBKï¼‰ï¼Œæœªè¿›è¡ŒURL encode* |
| 360æµè§ˆå™¨å…¼å®¹æ¨¡å¼          | UTF-8, URL encoded  | UTF-8, URL encoded       |

<small>* è¿™æ˜¯ç³»ç»Ÿé»˜è®¤æƒ…å†µã€‚ç”¨æˆ·å¯ä»¥åœ¨â€œInterneté€‰é¡¹â€çš„â€œé«˜çº§â€æ ‡ç­¾ä¸­å‹¾é€‰â€œå‘é€ï¼ˆéï¼‰Intranet URL çš„ UTF-8 æŸ¥è¯¢å­—ç¬¦ä¸²â€è®¾ç½®ï¼Œè®©IEåœ¨å‘é€è¯·æ±‚å‚æ•°æ—¶ä¹Ÿé‡‡ç”¨UTF-8ç¼–ç ã€‚</small>

## &lt;form&gt;è¡¨å•æäº¤
| æµ‹è¯•ç¯å¢ƒ         | GET                  | POSTï¼Œé»˜è®¤æƒ…å†µï¼ˆapplication/x-www-form-urlencodedï¼‰    | POSTï¼Œmultipart/form-data      |
|-----------------|----------------------|------------------------------------------------|--------------------------|
| æ‰€æœ‰æµ‹è¯•ç¯å¢ƒ      | éµå¾ªé¡µé¢ç¼–ç ï¼ˆContent-Typeï¼‰ï¼ŒURL encoded | éµå¾ªé¡µé¢ç¼–ç ï¼ˆContent-Typeï¼‰ï¼ŒURL encoded | éµå¾ªé¡µé¢ç¼–ç ï¼ˆContent-Typeï¼‰ï¼Œä½†ä¸è¿›è¡ŒURL encode

ä»¥ä¸Šå‡ä¸å—æ“ä½œç³»ç»Ÿå½±å“ã€‚ç”±äºä¸é¡µé¢ç¼–ç ä¸€è‡´ï¼Œé€šå¸¸ä¸ä¼šé‡åˆ°å‘ã€‚

å¦‚æœæ˜¯GBKè¡¨å•ï¼Œè€Œä¸”ç”¨æˆ·è¾“å…¥äº†GBKæ— æ³•è¡¨ç¤ºçš„æ–‡å­—ï¼ˆä¾‹å¦‚emojiï¼‰ï¼Œæµè§ˆå™¨ä¼šåœ¨æäº¤ä¹‹å‰è½¬ä¸ºHTMLç‰¹æ®Šå­—ç¬¦ç¼–ç ï¼ˆä¾‹å¦‚&amp;#127770;ï¼‰ã€‚

## jQueryçš„$.ajax
```js
// ä¸­æ–‡â‘ ï¼šåœ¨URLä¸­ä½¿ç”¨ä¸­æ–‡
// ä¸­æ–‡â‘¡ï¼šç›´æ¥åœ¨urlå‚æ•°ä¸­æ‹¼æ¥ä¸­æ–‡çš„æŸ¥è¯¢å‚æ•°
// ä¸­æ–‡â‘¢ï¼šåœ¨dataå‚æ•°ä¸­ä½¿ç”¨ä¸­æ–‡
$.ajax({
    url: '/get/ä¸­æ–‡â‘ ' + '?name=' + 'ä¸­æ–‡â‘¡',
    data: 'ä¸­æ–‡â‘¢',
    ...
});
```

| æµ‹è¯•ç¯å¢ƒ                  | ä¸­æ–‡â‘                | ä¸­æ–‡â‘¡                            | ä¸­æ–‡â‘¢                    |
|--------------------------|---------------------|----------------------------------|--------------------------|
| ç°ä»£æµè§ˆå™¨ï¼ˆæ—§ç‰ˆæœ¬ç«ç‹é™¤å¤–ï¼‰ | UTF-8, URL encoded  | è·Ÿéšé¡µé¢Content-Typeï¼ŒURL encoded  | UTF-8, URL encoded       |
| æ—§ç‰ˆæœ¬ç«ç‹                | UTF-8, URL encoded  | UTF-8, URL encoded                | UTF-8, URL encoded       |
| IE                       | UTF-8, URL encoded  | è·Ÿéšç³»ç»Ÿï¼ˆGBKï¼‰ï¼Œæœªè¿›è¡ŒURLç¼–ç *      | UTF-8, URL encoded       |

<small>* è¿™æ˜¯ç³»ç»Ÿé»˜è®¤æƒ…å†µã€‚ç”¨æˆ·å¯ä»¥åœ¨â€œInterneté€‰é¡¹â€çš„â€œé«˜çº§â€æ ‡ç­¾ä¸­å‹¾é€‰â€œå‘é€ï¼ˆéï¼‰Intranet URL çš„ UTF-8 æŸ¥è¯¢å­—ç¬¦ä¸²â€è®¾ç½®ï¼Œè®©IEåœ¨å‘é€è¯·æ±‚å‚æ•°æ—¶ä¹Ÿé‡‡ç”¨UTF-8ç¼–ç ã€‚</small>

ç”±ä¸Šè¡¨å¯ä»¥å¾—çŸ¥ï¼Œåº”å½“é¿å…åœ¨â€œä¸­æ–‡â‘¡â€ä½ç½®ä¸Šé¢æ‹¼æ¥æŸ¥è¯¢å‚æ•°ã€‚èº²æ‰è¿™ä¸ªå‘ä¹‹åï¼Œ$.ajaxæ€»æ˜¯UTF-8ç¼–ç ã€‚

# æ€»ç»“
* åº”é¿å…åœ¨URLä¸Šé¢æ‹¼æ¥ä¸­æ–‡å­—ç¬¦ã€‚
* å…¨é¢ä½¿ç”¨UTF-8ï¼Œå¯é¿å…ç¼–ç è½¬æ¢å¼•å‘çš„é—®é¢˜ã€‚
* å¦‚æœå…¨é¢ä½¿ç”¨GBKï¼Œåº”æ³¨æ„åˆ°ï¼šæŸäº›åœºæ™¯ä¸‹ï¼Œæµè§ˆå™¨ä¼šå°†å­—ç¬¦ä¸²ä»¥UTF-8ç¼–ç è¿›è¡ŒURL encodeç„¶åå†å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚æœåŠ¡å™¨æ–¹é¢éœ€ç•™æ„URL decodeä¸ç¼–ç è½¬æ¢çš„é—®é¢˜ã€‚

# é™„å½•ï¼šéƒ¨åˆ†æµ‹è¯•æˆªå›¾
## GETè¯·æ±‚ï¼Œç›´æ¥è¾“å…¥URL
`http://127.0.0.1:8000/get/ä¸­æ–‡`

![](/img/2020-03-21-luanma-2/get-1.png)

![](/img/2020-03-21-luanma-2/get-1-data.png)

æŒ‰UTF-8è¿›è¡Œäº†URL encodeã€‚

&nbsp;

`http://127.0.0.1:8000/get?name=ä¸­æ–‡`ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰

![](/img/2020-03-21-luanma-2/get-2.png)

![](/img/2020-03-21-luanma-2/get-2-data.png)

åŒæ ·æŒ‰UTF-8è¿›è¡Œäº†URL encodeã€‚

&nbsp;

`http://127.0.0.1:8000/get?name=ä¸­æ–‡`ï¼ˆIEï¼‰

![](/img/2020-03-21-luanma-2/get-3.png)

![](/img/2020-03-21-luanma-2/get-3-data.png)

IEæœªå¯¹â€œä¸­æ–‡â€äºŒå­—è¿›è¡ŒURL encodeï¼Œç›´æ¥ä»¥GBKç¼–ç åŸæ–‡å‘é€å‡ºå»äº†ã€‚

&nbsp;

## æäº¤&lt;form&gt;è¡¨å•ï¼ˆé€šå¸¸æƒ…å†µï¼‰
### UTF-8é¡µé¢
UTF-8è¡¨å•ï¼š`http://127.0.0.1:8000/form/utf-8`

åœ¨GETåŒºè¾“å…¥â€œä¸­æ–‡â€äºŒå­—å¹¶æäº¤ï¼š

![](/img/2020-03-21-luanma-2/get-2.png)

![](/img/2020-03-21-luanma-2/get-2-data.png)

ä¸ç›´æ¥è¾“å…¥ç½‘å€æ˜¯ä¸€è‡´çš„ã€‚

&nbsp;

åœ¨POSTåŒºè¾“å…¥â€œä¸­æ–‡â€äºŒå­—å¹¶æäº¤ï¼š

![](/img/2020-03-21-luanma-2/post-1.png)

![](/img/2020-03-21-luanma-2/post-1-data.png)

æµè§ˆå™¨ä¹Ÿè¿›è¡Œäº†URL encodeã€‚

&nbsp;

### GBKé¡µé¢
åˆ‡æ¢åˆ°GBKè¡¨å•ï¼š`http://127.0.0.1:8000/form/gbk`

åœ¨GETåŒºè¾“å…¥â€œä¸­æ–‡â€äºŒå­—å¹¶æäº¤ï¼š

![](/img/2020-03-21-luanma-2/get-4.png)

![](/img/2020-03-21-luanma-2/get-4-data.png)

æµè§ˆå™¨æŒ‰GBKç¼–ç è¿›è¡Œäº†URL encodeï¼Œä¸ç›´æ¥è¾“å…¥ç½‘å€çš„ç°è±¡ä¸åŒäº†ã€‚

&nbsp;

åœ¨POSTåŒºè¾“å…¥â€œä¸­æ–‡â€äºŒå­—å¹¶æäº¤ï¼š

![](/img/2020-03-21-luanma-2/post-2.png)

![](/img/2020-03-21-luanma-2/post-2-data.png)

æµè§ˆå™¨ä¹ŸæŒ‰GBKç¼–ç è¿›è¡Œäº†URL encodeã€‚

&nbsp;

## æäº¤&lt;form&gt;è¡¨å•ï¼ˆmultipart/form-dataï¼‰
UTF-8è¡¨å•ï¼š`http://127.0.0.1:8000/form/utf-8`

![](/img/2020-03-21-luanma-2/post-3.png)

![](/img/2020-03-21-luanma-2/post-3-data.png)

&nbsp;

åˆ‡æ¢åˆ°GBKè¡¨å•ï¼š`http://127.0.0.1:8000/form/gbk`

![](/img/2020-03-21-luanma-2/post-4.png)

![](/img/2020-03-21-luanma-2/post-4-data.png)

éƒ½æ˜¯åŸå°ä¸åŠ¨åœ°å°†æ–‡å­—å‘å‡ºå»äº†ã€‚

&nbsp;

## $.ajax
```js
// ä¸­æ–‡â‘ ï¼šåœ¨URLä¸­ä½¿ç”¨ä¸­æ–‡
// ä¸­æ–‡â‘¡ï¼šç›´æ¥åœ¨urlå‚æ•°ä¸­æ‹¼æ¥ä¸­æ–‡çš„æŸ¥è¯¢å‚æ•°
// ä¸­æ–‡â‘¢ï¼šåœ¨dataå‚æ•°ä¸­ä½¿ç”¨ä¸­æ–‡
$.ajax({
    url: '/get/ä¸­æ–‡â‘ ' + '?name=' + 'ä¸­æ–‡â‘¡',
    data: 'ä¸­æ–‡â‘¢',
    ...
});
```

### ä¸­æ–‡â‘ ä¸ä¸­æ–‡â‘¡ï¼ˆAjax Get 2æŒ‰é’®ï¼‰
#### UTF-8
![](/img/2020-03-21-luanma-2/ajax-1.png)

![](/img/2020-03-21-luanma-2/ajax-1-data.png)

å‡æŒ‰UTF-8è¿›è¡Œäº†URL encodeã€‚

&nbsp;

æ¢æˆIEæµè§ˆå™¨æ—¶ï¼š

![](/img/2020-03-21-luanma-2/ajax-2.png)

![](/img/2020-03-21-luanma-2/ajax-2-data.png)

åé¢çš„è¯·æ±‚å‚æ•°å¹¶ä¸æ˜¯UTF-8ï¼Œè€Œæ˜¯GBKï¼Œå¹¶ä¸”æœªè¿›è¡ŒURL encodeã€‚

&nbsp;

#### GBK
![](/img/2020-03-21-luanma-2/ajax-3.png)

![](/img/2020-03-21-luanma-2/ajax-3-data.png)

URLä»ç„¶æ˜¯UTF-8 + URL encodeï¼Œè€Œè¯·æ±‚å‚æ•°æ˜¯GBK + URL encodeã€‚

&nbsp;

æ¢æˆIEæµè§ˆå™¨æ—¶ï¼š

![](/img/2020-03-21-luanma-2/ajax-2.png)

![](/img/2020-03-21-luanma-2/ajax-2-data.png)

å’Œä¸Šé¢UTF-8è¡¨å•ä¸€æ ·ï¼Œåé¢çš„è¯·æ±‚å‚æ•°æ˜¯æœªç»è¿‡URL encodeçš„GBKã€‚

&nbsp;

å¯¹äºæ—§ç‰ˆæœ¬çš„Firefoxæµè§ˆå™¨ï¼š

![](/img/2020-03-21-luanma-2/ajax-4.png)

![](/img/2020-03-21-luanma-2/ajax-4-data.png)

å³ä½¿é¡µé¢ç¼–ç æ˜¯GBKï¼ŒURLå’Œè¯·æ±‚å‚æ•°ä»ç„¶éƒ½æ˜¯UTF-8 + URL encodeã€‚

&nbsp;

### ä¸­æ–‡â‘¢ï¼ˆAjax GETä¸Ajax POSTæŒ‰é’®ï¼‰
![](/img/2020-03-21-luanma-2/ajax-5.png)

![](/img/2020-03-21-luanma-2/ajax-6.png)

æ— è®ºé¡µé¢æ˜¯UTF-8è¿˜æ˜¯GBKï¼Œajaxå‘é€å‡ºå»çš„éƒ½æ˜¯UTF-8 + URL encodeã€‚IEä¹Ÿæ˜¯å¦‚æ­¤ã€‚

&nbsp;

## å…¶ä»–å·¥å…·
### curl
shellç¼–ç ï¼šUTF-8

`curl http://127.0.0.1:8000/get/ä¸­æ–‡`

![](/img/2020-03-21-luanma-2/curl-1.png)

![](/img/2020-03-21-luanma-2/curl-1-data.png)

&nbsp;

`curl 'http://127.0.0.1:8000/get?name=ä¸­æ–‡'`

![](/img/2020-03-21-luanma-2/curl-2.png)

![](/img/2020-03-21-luanma-2/curl-2-data.png)

&nbsp;

`curl -X POST -d 'name=ä¸­æ–‡' http://127.0.0.1:8000/post`

![](/img/2020-03-21-luanma-2/curl-3.png)

![](/img/2020-03-21-luanma-2/curl-3-data.png)

ç°è±¡ï¼šcurlæŠŠæ±‰å­—åŸå°ä¸åŠ¨åœ°å‘é€ç»™äº†æœåŠ¡å™¨ï¼Œä½†ç”±äºæ±‰å­—ä¸ç¬¦åˆRFC 1738çš„URLå­—ç¬¦çš„è§„èŒƒï¼ŒæœåŠ¡å™¨ç¨‹åºæ— æ³•æ­£ç¡®å¤„ç†ã€‚

&nbsp;

### Postman
æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ¥å£è°ƒè¯•è½¯ä»¶Postmanæ˜¯æŒ‰å“ªç§ç¼–ç å¤„ç†çš„ï¼š

`GET http://127.0.0.1:8000/get/ä¸­æ–‡`

![](/img/2020-03-21-luanma-2/postman-1.png)

&nbsp;

`GET http://127.0.0.1:8000/get?name=ä¸­æ–‡`

![](/img/2020-03-21-luanma-2/postman-2.png)

&nbsp;

`POST http://127.0.0.1:8000/post` (application/x-www-form-urlencoded)

![](/img/2020-03-21-luanma-2/postman-3.png)

&nbsp;

`POST http://127.0.0.1:8000/post` (application/json)

![](/img/2020-03-21-luanma-2/postman-4.png)

ç°è±¡ï¼šæ— è®ºMacè¿˜æ˜¯Windowsï¼ŒPostmanå‡æŒ‰UTF-8å¤„ç†äº†ã€‚ä»¥multipart/form-dataã€application/jsonç­‰å½¢å¼å‘é€æ—¶ï¼Œä¸ä¼šä¹Ÿä¸åº”è¯¥è¿›è¡ŒURL encodeã€‚

&nbsp;

## emojiğŸŒš
ä¼ å…¥ä¸€ä¸ªEmojiä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ

![](/img/2020-03-21-luanma-2/emoji-1.png)

&nbsp;

![](/img/2020-03-21-luanma-2/emoji-2.png)

é€šå¸¸æƒ…å†µä¸‹ï¼Œå’Œæ™®é€šæ±‰å­—çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚

&nbsp;

![](/img/2020-03-21-luanma-2/emoji-3.png)

è¿™ç§æƒ…å†µæœ¬æ¥æ˜¯æŒ‰GBKç¼–ç ä¼ é€’åŸæ–‡æ¥ç€ã€‚ç”±äºGBKç¼–ç æ— æ³•è¡¨ç¤ºâ€œğŸŒšâ€è¿™ä¸ªå­—ï¼Œäºæ˜¯å˜æˆäº†é—®å·ã€‚

&nbsp;

![](/img/2020-03-21-luanma-2/emoji-4.png)

åœ¨GBKè¡¨å•ä¸­è¾“å…¥â€œğŸŒšâ€å­—ï¼Œæµè§ˆå™¨å°†å…¶è½¬æ¢æˆäº†â€œ&amp;#127770;â€ã€‚

&nbsp;

# å‚è€ƒèµ„æ–™
* [å…³äºURLç¼–ç ](https://www.ruanyifeng.com/blog/2010/02/url_encoding.html)
* [æ·±å…¥åˆ†æ web è¯·æ±‚å“åº”ä¸­çš„ç¼–ç é—®é¢˜](https://www.ibm.com/developerworks/cn/web/wa-lo-ecoding-response-problem/index.html)

# æœ¬ç³»åˆ—æ–‡ç« 
* [ä¹±ç ç°è±¡æ¦‚è¿°](/2020/03/15/luanma-1/)
* **HTTP Requestä¸­æ–‡ç¼–ç æµ‹è¯•**
* [Tomcatä¸­æ–‡ç¼–ç æµ‹è¯•ï¼ˆLinux/Macï¼‰](/2020/04/05/luanma-3/)
* [Tomcatä¸­æ–‡ç¼–ç æµ‹è¯•ï¼ˆWindowsï¼‰](/2020/04/06/luanma-3.5/)
* MySQLä¸­æ–‡ç¼–ç æµ‹è¯•
* è¡¥æ•‘æªæ–½
    * GBKé¡µé¢ï¼Œå¦‚ä½•å¤„ç†Ajaxä¸­æ–‡ä¹±ç é—®é¢˜
