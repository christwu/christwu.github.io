---
layout: post
title: 跨公司接口联调
category: 经验
tags: 
- Web
- 内网穿透
---
记录一下在联调前后需要考虑的事情，以及内网穿透的操作方法。
<!-- more --> 

# 设计
1. 确保双方对于每个函数、每个参数的理解是一致的。特别是业务系统，对方对业务场景与业务的理解可能与我们很不一样；
2. 搞清楚接口调用时机、频率，估计一下接口调用数据规模，避免因为频率不当或者数据规模太大而出问题；
3. 有异常处理机制，能够正确处理目标服务器宕机、返回404、长时间不返回等情况。接口恢复后，故障期间产生的数据能够正确消化掉；
4. 检查输入数据是否合法；
5. 对于有状态的数据，约定好重复发送请求的后果。

# 执行
**务必要留证据！**有据可查，可以尽量避免承担无谓责任，尽量避免扯皮的情况。具体而言：

1. 记录哪天、与哪个人、调试了什么东西、结果如何；
2. 各接口函数要输出日志，记录时间、原始数据和一些关键数据；
3. 重要内容留截图。

# 补充技巧：内网穿透
理想情况下应该建立一个双方都便于访问的开发测试区。如果没有条件或者来不及准备，而且双方公司都能访问互联网，可以通过内网穿透的方法把本地应用映射到公网上。

操作之前去搞一台VPS。我个人推荐[Vultr](https://vultr.com)，因为国外不需要实名认证，而且Vultr按使用时间计费，可以随时买随时扔。对于内网穿透而言，最低配置的VPS足矣。

以Ubuntu系统为例，使用之前先在公司Ping一下，Ping不通说明被墙了，销毁之后再买一台即可。没问题的话，

```bash
sudo nano /etc/ssh/sshd_config
```

将其中的`GatewayPorts no`改成`yes`，没找到的话就在文件末尾追加一行，保存。然后

```bash
sudo systemctl restart sshd
```

准备工作就做好了。

联调时先去下载PuTTY，启动，在里面输入服务器地址和端口（默认22），并且按下图进行设置

![PuTTY设置](/img/cross-company-debug/putty-tunnel.png)

不要忘记点Add按钮。假如本机是`http://172.18.106.3:8080`，服务器IP是198.13.60.108，你选择的端口是8080，那么登录成功后就可以通过`http://198.13.60.108:8080`来访问自己的应用了。
